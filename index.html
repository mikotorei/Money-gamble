<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>2å€ or 0ï¼ˆã‚ªãƒ¼ãƒ«ã‚¤ãƒ³å›ºå®š + é‡‘åº« + è¨˜éŒ²/ç«¶èµ°ï¼‰</title>
  <style>
    body { font-family: system-ui, sans-serif; max-width: 820px; margin: 28px auto; padding: 0 14px; }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 16px; margin-bottom: 14px; }
    .row { display: flex; gap: 10px; flex-wrap: wrap; align-items: end; }
    .stats { display: grid; gap: 6px; }
    .big { font-size: 22px; }
    button { padding: 10px 14px; border-radius: 10px; border: 1px solid #ccc; cursor: pointer; }
    button:disabled { opacity: .5; cursor: not-allowed; }
    input[type="number"], input[type="text"], textarea {
      padding: 10px; border-radius: 10px; border: 1px solid #ccc; font-family: inherit;
    }
    textarea { width: 100%; min-height: 84px; resize: vertical; }
    #log { white-space: pre-wrap; background: #f7f7f7; padding: 12px; border-radius: 10px; border: 1px solid #eee; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border-bottom: 1px solid #eee; padding: 8px 6px; text-align: left; }
    th { font-size: 12px; color: #444; }
    .muted { color: #666; font-size: 12px; }
    .badge { display:inline-block; padding: 2px 8px; border:1px solid #ddd; border-radius: 999px; font-size: 12px; }
  </style>
</head>
<body>
  <h1>50%ã§2å€ / 50%ã§0ï¼ˆã‚ªãƒ¼ãƒ«ã‚¤ãƒ³å›ºå®š + é‡‘åº«ï¼‰</h1>

  <div class="card">
    <div class="row" style="justify-content: space-between; align-items: center;">
      <div>
        <div class="muted">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åï¼ˆå…±æœ‰ã‚³ãƒ¼ãƒ‰ã«å…¥ã‚‹ï¼‰</div>
        <div class="row">
          <input id="playerName" type="text" placeholder="ä¾‹ï¼šsetsuli" style="min-width: 220px;" />
          <button id="saveName">ä¿å­˜</button>
        </div>
      </div>
      <div class="muted">è¨˜éŒ²ã¨ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã¯ã“ã®ç«¯æœ«ã®ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã•ã‚Œã¾ã™</div>
    </div>
  </div>

  <div class="card">
    <div class="stats">
      <div>æ‰‹æŒã¡ï¼š<strong class="big" id="wallet"></strong></div>
      <div>é‡‘åº«ï¼š<strong class="big" id="vault"></strong></div>
      <div>åˆè¨ˆè³‡ç”£ï¼š<strong id="total"></strong></div>
      <div>å‹è² å›æ•°ï¼š<strong id="turn"></strong> / å‹ã¡ï¼š<strong id="wins"></strong> / è² ã‘ï¼š<strong id="losses"></strong></div>
    </div>
  </div>

  <div class="card">
    <div class="row">
      <button id="play">æ‰‹æŒã¡å…¨é¡ã§å‹è² ã™ã‚‹ï¼ˆã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ï¼‰</button>
      <button id="reset">ãƒªã‚»ãƒƒãƒˆ</button>
    </div>
    <p id="result"></p>
  </div>

  <div class="card">
    <h2 style="margin-top:0;">é‡‘åº«ï¼ˆå®‰å…¨ã«é€€é¿ï¼‰</h2>
    <div class="row">
      <input id="depositAmt" type="number" min="1" placeholder="é ã‘ã‚‹é¡ï¼ˆæ‰‹æŒã¡â†’é‡‘åº«ï¼‰" />
      <button id="deposit">é ã‘ã‚‹</button>

      <input id="withdrawAmt" type="number" min="1" placeholder="å¼•ãå‡ºã™é¡ï¼ˆé‡‘åº«â†’æ‰‹æŒã¡ï¼‰" />
      <button id="withdraw">å¼•ãå‡ºã™</button>

      <button id="depositHalf">æ‰‹æŒã¡ã®åŠåˆ†ã‚’é ã‘ã‚‹</button>
      <button id="withdrawAll">é‡‘åº«å…¨éƒ¨ã‚’å¼•ãå‡ºã™</button>
    </div>
  </div>

  <div class="card">
    <h2 style="margin-top:0;">æœ€é«˜è³‡ç”£ï¼ˆä¿å­˜ï¼‰</h2>
    <div class="row">
      <div class="stats" style="min-width: 320px;">
        <div>æœ€é«˜åˆè¨ˆè³‡ç”£ï¼š<strong class="big" id="bestTotal"></strong> <span class="badge" id="bestLabel"></span></div>
        <div class="muted">æ›´æ–°æ—¥æ™‚ï¼š<span id="bestAt"></span></div>
      </div>
      <div>
        <button id="clearBest">æœ€é«˜è¨˜éŒ²ã‚’æ¶ˆã™</button>
      </div>
    </div>
  </div>

  <div class="card">
    <h2 style="margin-top:0;">ä»²é–“å†…ã§ç«¶èµ°ï¼ˆå…±æœ‰ã‚³ãƒ¼ãƒ‰ï¼‰</h2>
    <div class="row">
      <button id="makeCode">è‡ªåˆ†ã®å…±æœ‰ã‚³ãƒ¼ãƒ‰ã‚’ä½œã‚‹</button>
      <button id="copyCode" disabled>ã‚³ãƒ”ãƒ¼</button>
      <button id="clearBoard">ã“ã®ç«¯æœ«ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’æ¶ˆã™</button>
    </div>

    <div class="muted" style="margin-top:8px;">è‡ªåˆ†ã®å…±æœ‰ã‚³ãƒ¼ãƒ‰ï¼š</div>
    <textarea id="myCode" readonly></textarea>

    <div class="muted" style="margin-top:12px;">ç›¸æ‰‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è²¼ã£ã¦è¿½åŠ ï¼š</div>
    <div class="row">
      <input id="theirCode" type="text" placeholder="ç›¸æ‰‹ã®å…±æœ‰ã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚‹" style="flex: 1; min-width: 260px;" />
      <button id="addCode">è¿½åŠ </button>
    </div>

    <h3 style="margin:14px 0 6px;">ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆã“ã®ç«¯æœ«ï¼‰</h3>
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>åå‰</th>
          <th>æœ€é«˜åˆè¨ˆè³‡ç”£</th>
          <th>æ›´æ–°æ—¥æ™‚</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="boardBody"></tbody>
    </table>
  </div>

  <div class="card">
    <h2 style="margin-top:0;">å±¥æ­´</h2>
    <div id="log"></div>
  </div>

  <script>
    const INITIAL_WALLET = 100;
    const INITIAL_VAULT  = 0;

    const LS_PLAYER = "don_player_name_v1";
    const LS_BEST   = "don_best_v1";
    const LS_BOARD  = "don_board_v1";

    let wallet = INITIAL_WALLET;
    let vault  = INITIAL_VAULT;
    let turn = 0, wins = 0, losses = 0;

    const walletEl = document.getElementById("wallet");
    const vaultEl  = document.getElementById("vault");
    const totalEl  = document.getElementById("total");
    const turnEl   = document.getElementById("turn");
    const winsEl   = document.getElementById("wins");
    const lossesEl = document.getElementById("losses");
    const resultEl = document.getElementById("result");
    const logEl    = document.getElementById("log");
    const bestTotalEl = document.getElementById("bestTotal");
    const bestAtEl    = document.getElementById("bestAt");
    const bestLabelEl = document.getElementById("bestLabel");
    const playerNameInput = document.getElementById("playerName");
    const myCodeTA = document.getElementById("myCode");
    const copyBtn  = document.getElementById("copyCode");
    const theirCodeInput = document.getElementById("theirCode");
    const boardBody = document.getElementById("boardBody");

    function fmt(n){ return Number(n).toLocaleString(); }
    function now(){ return Date.now(); }
    function dt(ts){ return ts ? new Date(ts).toLocaleString() : "â€”"; }
    function addLog(t){ logEl.textContent = t + "\n" + logEl.textContent; }

    function loadBest(){
      try{ return JSON.parse(localStorage.getItem(LS_BEST)) || {bestTotal:0,bestAt:0,label:""}; }
      catch{ return {bestTotal:0,bestAt:0,label:""}; }
    }
    function saveBest(b){ localStorage.setItem(LS_BEST, JSON.stringify(b)); }
    function maybeUpdateBest(label){
      const total = wallet + vault;
      const best = loadBest();
      if(total > best.bestTotal){
        const upd = {bestTotal:total,bestAt:now(),label};
        saveBest(upd);
        renderBest();
        addLog(`ğŸ† æœ€é«˜è³‡ç”£æ›´æ–° ${fmt(total)}`);
      }
    }
    function renderBest(){
      const b = loadBest();
      bestTotalEl.textContent = fmt(b.bestTotal);
      bestAtEl.textContent = dt(b.bestAt);
      bestLabelEl.textContent = b.label || "â€”";
    }

    function render(){
      walletEl.textContent = fmt(wallet);
      vaultEl.textContent = fmt(vault);
      totalEl.textContent = fmt(wallet+vault);
      turnEl.textContent = turn;
      winsEl.textContent = wins;
      lossesEl.textContent = losses;
      document.getElementById("play").disabled = wallet<=0;
    }

    document.getElementById("play").addEventListener("click",()=>{
      if(wallet<=0)return;
      turn++;
      const bet = wallet;
      wallet = 0;
      if(Math.random()<0.5){
        wins++;
        wallet = bet*2;
        resultEl.textContent = `#${turn}: å‹ã¡ ${fmt(wallet)}`;
        maybeUpdateBest("å‹è² ");
      }else{
        losses++;
        resultEl.textContent = `#${turn}: è² ã‘ 0`;
      }
      render();
    });

    document.getElementById("deposit").addEventListener("click",()=>{
      const amt = Math.floor(Number(document.getElementById("depositAmt").value));
      if(!amt||amt<=0||amt>wallet)return;
      wallet-=amt; vault+=amt;
      maybeUpdateBest("é€€é¿");
      render();
    });

    // â˜… åŠåˆ†é ã‘ã‚‹ãƒœã‚¿ãƒ³
    document.getElementById("depositHalf").addEventListener("click",()=>{
      if(wallet<=1)return;
      const amt = Math.floor(wallet/2);
      wallet-=amt;
      vault+=amt;
      addLog(`ğŸ¦ åŠåˆ†é ã‘ ${fmt(amt)}`);
      maybeUpdateBest("åŠåˆ†é€€é¿");
      render();
    });

    document.getElementById("withdraw").addEventListener("click",()=>{
      const amt = Math.floor(Number(document.getElementById("withdrawAmt").value));
      if(!amt||amt<=0||amt>vault)return;
      vault-=amt; wallet+=amt;
      render();
    });

    document.getElementById("withdrawAll").addEventListener("click",()=>{
      wallet+=vault; vault=0; render();
    });

    document.getElementById("reset").addEventListener("click",()=>{
      wallet=INITIAL_WALLET; vault=INITIAL_VAULT;
      turn=0; wins=0; losses=0;
      render();
    });

    render();
    renderBest();
  </script>
</body>
</html>
